# Contributing to QCP

## üêõ Bug reports & Feature requests

Bug reports and feature requests are welcome, please open an [issue].

- It may be useful to check the [issues list] and the [discussions] first in case somebody else has already raised it.
- Please be aware that I mostly work on this project in my own time.

## üèóÔ∏è Pull request policy

If you're thinking of contributing something non-trivial, it might be best to raise it in [discussions] first so you can get feedback early. This is particularly important for new features, to ensure they are aligned with the project goals and your approach is suitable.

- Changes should normally be based on the `dev` branch. _(Exception: hotfixes may be branched against `main`.)_
- PRs must pass the full set of CI checks (see below). No exceptions.
- Unit tests are encouraged, particularly those which fail before and pass after a fix.
  - The CI workflow runs code coverage analysis.
- Refactoring for its own sake is OK if driven by a feature or bugfix.
- Clean commit histories are preferred, but don't be discouraged if you don't know how to do this. git can be a tricky tool.
- Commit messages should follow [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/).
  - Begin the commit message for a feature with `feat:`. If it's a bugfix, use `fix:`.
  - For a full list of supported message tags, look at `commit_parsers` in [release-plz.toml](release-plz.toml).
  - This policy is in force since release 0.1.0. Earlier commits are considered grandfathered in.
- Where there is an issue number, commit messages should reference it, e.g. (#12)
- Do not edit CHANGELOG.md, that will be done for you on release.
- If you have changed any CLI options, do not directly edit the man pages or HTML in `qcp/misc/generated/`. These are autogenerated. Instead:
  - Edit the CLI doc comments appropriately (`qcp::cli::args::CliArgs`, `qcp::client::options::Parameters` and `qcp::config::structure::Configuration`)
  - Run `qcp --help`, make sure the wording and formatting there is reasonable.
  - Run `scripts/generate-cli-docs` and include the changed output in your commit. _(You may need to `cargo install --locked dprint` )_

## ‚òëÔ∏è CI checks applied

There is a utility script `scripts/pre-commit-checks` which runs the non-compiling checks. It is intended to be used as a git pre-commit script.

To use it you may need to install some additional tooling:

- cargo install --locked cargo-machete cargo-shear dprint typos-cli@1.39.0

| Check                                   | How to run it yourself          | Notes                                                                     |
| --------------------------------------- | ------------------------------- | ------------------------------------------------------------------------- |
| Spellcheck                              | `typos`                         | `cargo install typos-cli@1.39.0 --locked`                                 |
| Code style                              | `cargo fmt --all --check`       | For VS Code users, `editor.formatOnSave=true` is set                      |
| Non-code style (.md, .toml, .yml files) | `dprint check` or `dprint fmt`  | `cargo install --locked dprint`                                           |
| Dependencies check                      | `cargo machete --with-metadata` | `cargo install --locked cargo-machete`                                    |
| Dependencies check 2                    | `cargo shear --locked`          | `cargo install --locked cargo-shear`                                      |
| Everything must build                   | `cargo build --all-targets`     |                                                                           |
| Unit tests pass                         | `cargo test`                    |                                                                           |
| Lints                                   | `cargo clippy --all-targets`    | This is a reasonably pedantic set of lints, which I make no apologies for |
| Docs build                              | `cargo doc --no-deps`           |                                                                           |
| Code coverage                           | `./scripts/coverage`            | Output is in `target/coverage/html`                                       |

[issue]: https://github.com/crazyscot/qcp/issues/new/choose
[issues list]: https://github.com/crazyscot/qcp/issues
[discussions]: https://github.com/crazyscot/qcp/discussions
